;/*FB_PKG_DELIM*/

__d("LSUpdateOptimisticEphemeralMediaState",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(d){return b.sequence([function(c){return b.i64.neq(a[3],void 0)?b.filter(b.db.table(16).fetch([[[a[0],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&(b.i64.eq(c.attachmentType,b.i64.cast([0,8]))||b.i64.eq(c.attachmentType,b.i64.cast([0,9])))&&b.i64.eq(c.ephemeralMediaState,b.i64.cast([0,0]))}).next().then(function(c,d){d=c.done;c=c.value;return d?b.forEach(b.filter(b.db.table(16).fetch([[[a[0],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&(b.i64.eq(c.attachmentType,b.i64.cast([0,8]))||b.i64.eq(c.attachmentType,b.i64.cast([0,9])))}),function(b){var c=b.update;b.item;return c({ephemeralMediaState:a[2],viewerSeenTimestampMs:a[3]})}):(c.item,b.forEach(b.filter(b.db.table(16).fetch([[[a[0],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&(b.i64.eq(c.attachmentType,b.i64.cast([0,8]))||b.i64.eq(c.attachmentType,b.i64.cast([0,9])))}),function(b){var c=b.update;b.item;return c({viewerSeenTimestampMs:a[3]})}))}):b.filter(b.db.table(16).fetch([[[a[0],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&(b.i64.eq(c.attachmentType,b.i64.cast([0,8]))||b.i64.eq(c.attachmentType,b.i64.cast([0,9])))&&b.i64.eq(c.ephemeralMediaState,b.i64.cast([0,0]))}).next().then(function(c,d){d=c.done;c=c.value;return d?b.forEach(b.filter(b.db.table(16).fetch([[[a[0],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&(b.i64.eq(c.attachmentType,b.i64.cast([0,8]))||b.i64.eq(c.attachmentType,b.i64.cast([0,9])))}),function(b){var c=b.update;b.item;return c({ephemeralMediaState:a[2]})}):(c.item,0)})},function(a){return c[0]=!0}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateOptimisticEphemeralMediaStateStoredProcedure";a.__tables__=["attachments"];e.exports=a}),null);